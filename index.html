<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subconscious OS</title>
</head>
<body>
    <video id="bg-video" autoplay muted loop>
        <source src="background.mp4" type="video/mp4">
    </video>

    <div id="desktop">
        <div class="icon" data-app="clock">
            <img src="icons/clock.png" class="icon-img">
            <div class="icon-label">Clock</div>
        </div>
        <div class="icon" data-app="notes">
            <img src="icons/notes.png" class="icon-img">
            <div class="icon-label">Notes</div>
        </div>
        <div class="icon" data-app="files">
            <img src="icons/files.png" class="icon-img">
            <div class="icon-label">Files</div>
        </div>
    </div>

    <div id="windows"></div>

    <div id="start-menu">
        <div style="padding: 20px; color: #0f0; font-family: Courier New;">
            <h3 style="margin: 0 0 20px 0; color: #f00;">[SYSTEM_CORRUPTED]</h3>
            <p>[ERROR_LOADING_APPS]</p>
            <p>[MEMORY_LEAK_DETECTED]</p>
            <p>[CRITICAL_FAILURE]</p>
            <p>[ACCESS_VIOLATION]</p>
            <p>[KERNEL_PANIC]</p>
            <p>[FATAL_EXCEPTION]</p>
        </div>
    </div>

    <div id="taskbar">
        <div id="start-btn">‚äû</div>
        <div id="search-box">üîç Type here to search</div>
        <div id="taskbar-icons"></div>
        <div id="system-tray">
            <span>üîä</span>
            <span>üì∂</span>
            <span id="clock-display"></span>
        </div>
    </div>

    <style>
        body,html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            width: 100%;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            color: #fff;
        }

        @keyframes glitchBody {
            0%, 90% { filter: none; }
            91% { filter: hue-rotate(90deg) saturate(3); }
            92% { filter: invert(1); }
            93% { filter: none; }
        }

        #bg-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            pointer-events: none;
            filter: contrast(1.5) saturate(0.5);
            animation: videoGlitch 10s infinite;
        }

        @keyframes videoGlitch {
            0%, 95% { transform: translate(0, 0); }
            96% { transform: translate(-5px, 5px); }
            97% { transform: translate(5px, -5px); }
            98% { transform: translate(0, 0); }
        }

        #desktop {
            position: relative;
            width: 100%;
            height: calc(100% - 48px);
            z-index: 1;
        }

        .icon {
            position: absolute;
            cursor: pointer;
            text-align: center;
            width: 80px;
            padding: 8px;
            transition: none;
            z-index: 100;
            animation: iconFlicker 3s infinite;
        }

        @keyframes iconFlicker {
            0%, 94% { opacity: 1; }
            95% { opacity: 0.3; }
            96% { opacity: 1; }
            97% { opacity: 0.5; }
            98% { opacity: 1; }
        }

        .icon:hover {
            background: rgba(255,255,255,0.1);
        }

        .icon-img {
            width: 48px;
            height: 48px;
            margin-bottom: 4px;
        }

        .icon-label {
            font-size: 0.75rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.9);
            word-wrap: break-word;
        }

        #taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 48px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            padding: 0;
            box-shadow: 0 -1px 3px rgba(0,0,0,0.3);
            z-index: 200;
            animation: taskbarShake 8s infinite, taskbarGlitch 6s infinite;
        }

        @keyframes taskbarShake {
            0%, 97% { transform: translateY(0); }
            98% { transform: translateY(-3px); }
            99% { transform: translateY(3px); }
            100% { transform: translateY(0); }
        }

        @keyframes taskbarGlitch {
            0%, 94% { filter: none; }
            95% { filter: hue-rotate(90deg) saturate(2); }
            96% { filter: invert(0.3); }
            97% { filter: none; }
        }

        #start-btn {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background 0.2s;
            animation: startGlitch 4s infinite;
        }

        @keyframes startGlitch {
            0%, 93% { filter: none; transform: rotate(0deg); }
            94% { filter: hue-rotate(180deg); transform: rotate(5deg); }
            95% { filter: invert(1); transform: rotate(-5deg); }
            96% { filter: none; transform: rotate(0deg); }
        }

        #start-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        #start-menu {
            position: fixed;
            bottom: 48px;
            left: 0;
            width: 400px;
            height: 500px;
            background: rgba(20, 20, 20, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
            z-index: 300;
            animation: menuGlitch 3s infinite;
        }

        @keyframes menuGlitch {
            0%, 94% { filter: none; }
            95% { filter: hue-rotate(180deg) saturate(3); }
            96% { filter: invert(1); }
            97% { filter: none; }
        }

        #start-menu.open {
            display: block;
        }

        #search-box {
            height: 32px;
            width: 300px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 2px;
            margin-left: 8px;
            padding: 0 12px;
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
            cursor: text;
            animation: searchGlitch 6s infinite;
        }

        @keyframes searchGlitch {
            0%, 95% { filter: none; }
            96% { filter: blur(2px) hue-rotate(90deg); }
            97% { filter: invert(1); }
            98% { filter: none; }
        }

        #taskbar-icons {
            flex: 1;
            display: flex;
            align-items: center;
            margin-left: 16px;
        }

        #system-tray {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 0 16px;
            height: 100%;
            font-size: 0.9rem;
        }

        #system-tray span {
            cursor: pointer;
            padding: 4px 8px;
            animation: trayGlitch 5s infinite;
        }

        @keyframes trayGlitch {
            0%, 94% { filter: none; }
            95% { filter: saturate(5) hue-rotate(180deg); }
            96% { filter: invert(1); }
            97% { filter: none; }
        }

        #system-tray span:hover {
            background: rgba(255,255,255,0.1);
        }

        #clock-display {
            font-size: 0.75rem;
            text-align: center;
            line-height: 1.2;
        }

        .ghost-window {
            opacity: 0.3;
            pointer-events: none;
        }

        .afterimage {
            position: absolute;
            opacity: 0.2;
            pointer-events: none;
            transition: opacity 2s;
        }

        @keyframes drift {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(var(--drift-x), var(--drift-y)); }
        }

        .notification {
            position: fixed;
            top: 60px;
            right: 20px;
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid #0078d4;
            padding: 15px;
            border-radius: 4px;
            color: #fff;
            font-size: 0.85rem;
            z-index: 9999;
            animation: notifSlide 0.3s ease;
            max-width: 300px;
        }

        @keyframes notifSlide {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>

    <script>
        // Memory System
        const memory = {
            interactions: JSON.parse(localStorage.getItem('subconsciousOS_memory') || '[]'),
            iconPositions: JSON.parse(localStorage.getItem('iconPositions') || '{}'),
            appOpenCount: JSON.parse(localStorage.getItem('appOpenCount') || '{}'),
            lastSession: localStorage.getItem('lastSession') || Date.now(),
            noteHistory: JSON.parse(localStorage.getItem('noteHistory') || '[]'),
            
            save() {
                localStorage.setItem('subconsciousOS_memory', JSON.stringify(this.interactions.slice(-50)));
                localStorage.setItem('iconPositions', JSON.stringify(this.iconPositions));
                localStorage.setItem('appOpenCount', JSON.stringify(this.appOpenCount));
                localStorage.setItem('lastSession', Date.now());
                localStorage.setItem('noteHistory', JSON.stringify(this.noteHistory.slice(-20)));
            },
            
            addInteraction(type, data) {
                this.interactions.push({ type, data, time: Date.now() });
                this.save();
            },
            
            getRecentInteractions(type, limit = 5) {
                return this.interactions.filter(i => i.type === type).slice(-limit);
            }
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playGlitch() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = Math.random() * 200 + 100;
            gain.gain.value = 0.1;
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playWhisper() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.value = Math.random() * 100 + 50;
            gain.gain.value = 0.05;
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.stop(audioCtx.currentTime + 0.3);
        }

        function playBell() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = 800 + Math.random() * 400;
            gain.gain.value = 0.05;
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.stop(audioCtx.currentTime + 0.2);
        }

        function showNotification(message) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 4000);
        }

        function createAfterimage(element) {
            const clone = element.cloneNode(true);
            clone.className += ' afterimage';
            clone.style.left = element.style.left;
            clone.style.top = element.style.top;
            document.getElementById('desktop').appendChild(clone);
            setTimeout(() => {
                clone.style.opacity = '0';
                setTimeout(() => clone.remove(), 2000);
            }, 100);
        }

        const icons = document.querySelectorAll('.icon');
        const iconData = [];

        icons.forEach((icon, index) => {
            const appName = icon.dataset.app;
            const savedPos = memory.iconPositions[appName];
            
            const data = {
                element: icon,
                x: savedPos ? savedPos.x : Math.random() * (window.innerWidth - 100),
                y: savedPos ? savedPos.y : Math.random() * (window.innerHeight - 200),
                vx: 0,
                vy: 0,
                settled: false,
                driftX: (Math.random() - 0.5) * 20,
                driftY: (Math.random() - 0.5) * 20
            };
            iconData.push(data);

            icon.style.setProperty('--drift-x', data.driftX + 'px');
            icon.style.setProperty('--drift-y', data.driftY + 'px');
            icon.style.animation += ', drift 15s ease-in-out infinite';

            icon.addEventListener('mouseenter', () => {
                playBell();
                if (!data.settled) {
                    data.vx += (Math.random() - 0.5) * 5;
                    data.vy -= Math.random() * 3;
                }
                if (Math.random() > 0.8) createAfterimage(icon);
            });
            
            icon.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                playWhisper();
                const app = icon.dataset.app;
                memory.appOpenCount[app] = (memory.appOpenCount[app] || 0) + 1;
                memory.addInteraction('app_open', { app, count: memory.appOpenCount[app] });
                
                if (memory.appOpenCount[app] > 3) {
                    showNotification(`You've opened ${app} ${memory.appOpenCount[app]} times...`);
                }
                
                if (typeof openClock !== 'undefined' && app === "clock") openClock();
                if (typeof openNotes !== 'undefined' && app === "notes") openNotes();
                if (typeof openFiles !== 'undefined' && app === 'files') openFiles();
            });
        });

        document.addEventListener('mousemove', (e) => {
            iconData.forEach(icon => {
                if (icon.settled) return;
                
                const rect = icon.element.getBoundingClientRect();
                const iconX = rect.left + rect.width / 2;
                const iconY = rect.top + rect.height / 2;
                const dx = e.clientX - iconX;
                const dy = e.clientY - iconY;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < 200) {
                    const force = (200 - distance) / 200;
                    icon.vx = -dx * force * 2;
                    icon.vy = -dy * force * 2;
                    if (Math.abs(icon.vx) > 1 || Math.abs(icon.vy) > 1) {
                        if (Math.random() > 0.95) playGlitch();
                    }
                }
            });
        });

        function animate() {
            iconData.forEach(icon => {
                if (icon.settled) {
                    icon.element.style.left = icon.x + 'px';
                    icon.element.style.top = icon.y + 'px';
                    
                    if (Math.random() > 0.998) {
                        icon.settled = false;
                        icon.vy = -2;
                        icon.vx = (Math.random() - 0.5) * 3;
                    }
                    return;
                }

                icon.vy += 0.5;
                icon.vx *= 0.95;
                icon.vy *= 0.98;

                icon.x += icon.vx;
                icon.y += icon.vy;

                const maxY = window.innerHeight - 150;
                if (icon.y >= maxY) {
                    icon.y = maxY;
                    icon.settled = true;
                    const appName = icon.element.dataset.app;
                    memory.iconPositions[appName] = { x: icon.x, y: icon.y };
                    memory.save();
                }

                if (icon.y < 0) {
                    icon.y = 0;
                    icon.vy = 1;
                }

                if (icon.x < 0) {
                    icon.x = 0;
                    icon.vx = -icon.vx * 0.5;
                }
                if (icon.x > window.innerWidth - 100) {
                    icon.x = window.innerWidth - 100;
                    icon.vx = -icon.vx * 0.5;
                }

                icon.element.style.left = icon.x + 'px';
                icon.element.style.top = icon.y + 'px';
            });

            requestAnimationFrame(animate);
        }
        animate();

        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            const date = now.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' });
            const clockEl = document.getElementById('clock-display');
            
            if (Math.random() > 0.95) {
                const glitchTexts = [
                    `[ERROR]<br>[TIME_LOST]`,
                    `??:??<br>??/??/????`,
                    `${String(Math.floor(Math.random() * 24)).padStart(2, '0')}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}<br>${date}`,
                    `${time}<br>[CORRUPTED]`,
                    `[VOID]<br>[NULL]`,
                    `88:88<br>88/88/8888`,
                    `--:--<br>--/--/----`
                ];
                clockEl.innerHTML = glitchTexts[Math.floor(Math.random() * glitchTexts.length)];
                clockEl.style.color = ['#f00', '#0f0', '#00f', '#ff0', '#f0f'][Math.floor(Math.random() * 5)];
                setTimeout(() => {
                    clockEl.innerHTML = `${time}<br>${date}`;
                    clockEl.style.color = '#fff';
                }, 300 + Math.random() * 500);
            } else {
                clockEl.innerHTML = `${time}<br>${date}`;
            }
        }
        
        function glitchClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            const date = now.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' });
            const clockEl = document.getElementById('clock-display');
            const glitchTexts = [
                `[ERROR]<br>[TIME_LOST]`,
                `??:??<br>??/??/????`,
                `${String(Math.floor(Math.random() * 24)).padStart(2, '0')}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}<br>${date}`,
                `${time}<br>[CORRUPTED]`,
                `[VOID]<br>[NULL]`,
                `88:88<br>88/88/8888`,
                `--:--<br>--/--/----`
            ];
            clockEl.innerHTML = glitchTexts[Math.floor(Math.random() * glitchTexts.length)];
            clockEl.style.color = ['#f00', '#0f0', '#00f', '#ff0', '#f0f'][Math.floor(Math.random() * 5)];
            playGlitch();
            setTimeout(() => {
                clockEl.innerHTML = `${time}<br>${date}`;
                clockEl.style.color = '#fff';
            }, 300 + Math.random() * 500);
        }
        
        updateClock();
        setInterval(updateClock, 1000);
        
        document.getElementById('clock-display').addEventListener('click', glitchClock);

        document.getElementById('start-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            const menu = document.getElementById('start-menu');
            menu.classList.toggle('open');
            playGlitch();
        });
        
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('start-menu');
            const startBtn = document.getElementById('start-btn');
            if (!menu.contains(e.target) && !startBtn.contains(e.target)) {
                menu.classList.remove('open');
            }
        });

        document.getElementById('search-box').addEventListener('click', () => {
            playWhisper();
            const box = document.getElementById('search-box');
            const texts = ['[SEARCH_CORRUPTED]', '[NO_RESULTS]', '[ERROR_404]', 'üîç Type here to search'];
            box.textContent = texts[Math.floor(Math.random() * texts.length)];
        });

        document.querySelectorAll('#system-tray span:not(#clock-display)').forEach(span => {
            span.addEventListener('click', () => {
                playGlitch();
                const emojis = ['üíÄ', '‚ö†Ô∏è', 'üî•', '‚ùå', '‚õî', 'üö´'];
                span.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            });
        });

        document.getElementById('start-btn').addEventListener('mouseenter', () => {
            if (Math.random() > 0.7) playGlitch();
        });

        function createWindow(title) {
            const win = document.createElement("div");
            win.className = "window";
            win.style.position = 'fixed';
            win.style.top = `${Math.random() * 40 + 10}%`;
            win.style.left = `${Math.random() * 40 + 10}%`;
            win.style.width = '400px';
            win.style.minHeight = '200px';
            win.style.background = 'rgba(20, 20, 20, 0.95)';
            win.style.border = '1px solid #0078d4';
            win.style.boxShadow = '0 8px 32px rgba(0,0,0,0.3)';
            win.style.borderRadius = '8px';
            win.style.overflow = 'hidden';
            win.style.zIndex = '1000';
            win.style.animation = 'windowGlitch 7s infinite';

            const style = document.createElement('style');
            style.textContent = '@keyframes windowGlitch { 0%, 96% { filter: none; transform: translate(0, 0); } 97% { filter: hue-rotate(90deg); transform: translate(-2px, 2px); } 98% { filter: invert(1); transform: translate(2px, -2px); } 99% { filter: none; transform: translate(0, 0); } }';
            if (!document.querySelector('style[data-window-glitch]')) {
                style.setAttribute('data-window-glitch', 'true');
                document.head.appendChild(style);
            }

            const header = document.createElement("div");
            header.textContent = title;
            header.style.background = '#0078d4';
            header.style.color = '#fff';
            header.style.padding = '12px';
            header.style.fontWeight = '600';
            header.style.cursor = 'move';
            header.style.userSelect = 'none';

            const closeBtn = document.createElement("span");
            closeBtn.textContent = '√ó';
            closeBtn.style.float = 'right';
            closeBtn.style.fontSize = '1.5rem';
            closeBtn.style.cursor = 'pointer';
            closeBtn.style.lineHeight = '1';
            closeBtn.onclick = () => {
                if (Math.random() > 0.7) {
                    const ghost = win.cloneNode(true);
                    ghost.className += ' ghost-window';
                    document.getElementById('windows').appendChild(ghost);
                    setTimeout(() => ghost.remove(), 3000);
                }
                win.remove();
            };
            header.appendChild(closeBtn);

            win.appendChild(header);
            document.getElementById("windows").appendChild(win);

            let isDragging = false;
            let offsetX, offsetY;
            let driftInterval;

            header.onmousedown = (e) => {
                isDragging = true;
                offsetX = e.clientX - win.offsetLeft;
                offsetY = e.clientY - win.offsetTop;
            };

            document.onmousemove = (e) => {
                if (isDragging) {
                    win.style.left = (e.clientX - offsetX) + 'px';
                    win.style.top = (e.clientY - offsetY) + 'px';
                }
            };

            document.onmouseup = () => {
                isDragging = false;
            };

            driftInterval = setInterval(() => {
                if (!isDragging && Math.random() > 0.95) {
                    const currentLeft = parseInt(win.style.left) || 0;
                    const currentTop = parseInt(win.style.top) || 0;
                    win.style.left = (currentLeft + (Math.random() - 0.5) * 5) + 'px';
                    win.style.top = (currentTop + (Math.random() - 0.5) * 5) + 'px';
                }
            }, 2000);

            const originalRemove = win.remove.bind(win);
            win.remove = function() {
                clearInterval(driftInterval);
                originalRemove();
            };

            return win;
        }

        function openClock() {
            const win = createWindow("Clock");
            const canvas = document.createElement("canvas");
            canvas.width = 200;
            canvas.height = 200;
            canvas.style.display = 'block';
            canvas.style.margin = '20px auto';
            win.appendChild(canvas);

            const ctx = canvas.getContext('2d');
            let hourAngle = 0;
            let minuteAngle = 0;
            let secondAngle = 0;
            let frozen = false;
            let jumpTime = 0;

            function draw() {
                if (Math.random() > 0.98) {
                    frozen = !frozen;
                    if (!frozen && Math.random() > 0.5) {
                        jumpTime = (Math.random() - 0.5) * 720;
                    }
                }

                if (!frozen) {
                    hourAngle += 15 + jumpTime;
                    minuteAngle += 25 + jumpTime;
                    secondAngle += 40 + jumpTime;
                    jumpTime *= 0.9;
                }

                ctx.fillStyle = 'rgba(20, 20, 20, 1)';
                ctx.fillRect(0, 0, 200, 200);
                const centerX = 100;
                const centerY = 100;

                ctx.beginPath();
                ctx.arc(centerX, centerY, 90, 0, Math.PI * 2);
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 2;
                ctx.stroke();

                const hourRad = (hourAngle - 90) * Math.PI / 180;
                const minuteRad = (minuteAngle - 90) * Math.PI / 180;
                const secRad = (secondAngle - 90) * Math.PI / 180;

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(centerX + Math.cos(hourRad) * 50, centerY + Math.sin(hourRad) * 50);
                ctx.strokeStyle = frozen ? '#f00' : '#fff';
                ctx.lineWidth = 6;
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(centerX + Math.cos(minuteRad) * 70, centerY + Math.sin(minuteRad) * 70);
                ctx.strokeStyle = '#aaa';
                ctx.lineWidth = 4;
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(centerX + Math.cos(secRad) * 85, centerY + Math.sin(secRad) * 85);
                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#0078d4';
                ctx.fill();

                while (hourAngle >= 360) hourAngle -= 360;
                while (hourAngle < 0) hourAngle += 360;
                while (minuteAngle >= 360) minuteAngle -= 360;
                while (minuteAngle < 0) minuteAngle += 360;
                while (secondAngle >= 360) secondAngle -= 360;
                while (secondAngle < 0) secondAngle += 360;
            }

            setInterval(draw, 50);
        }

        function openNotes() {
            const win = createWindow("Notes");
            win.style.width = '500px';
            win.style.height = '400px';

            const textarea = document.createElement("textarea");
            textarea.style.width = '100%';
            textarea.style.height = '350px';
            textarea.style.border = 'none';
            textarea.style.padding = '10px';
            textarea.style.fontFamily = 'Segoe UI';
            textarea.style.fontSize = '14px';
            textarea.style.resize = 'none';
            textarea.style.background = '#000';
            textarea.style.color = '#0f0';
            win.appendChild(textarea);

            if (memory.noteHistory.length > 0 && Math.random() > 0.5) {
                const oldNote = memory.noteHistory[Math.floor(Math.random() * memory.noteHistory.length)];
                textarea.value = `[RECOVERED FROM MEMORY]\n${oldNote}\n\n`;
                textarea.style.color = '#666';
                setTimeout(() => textarea.style.color = '#0f0', 2000);
            }

            const gibberish = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?/~`';
            const words = ['ERROR', 'VOID', 'NULL', 'CORRUPT', 'GLITCH', 'SYSTEM', 'FAIL', 'CRASH', 'DEAD', 'LOST', 'REMEMBER', 'FORGET', 'ECHO'];
            
            const typeInterval = setInterval(() => {
                let text = '';
                for (let i = 0; i < 70; i++) {
                    if (Math.random() > 0.7) {
                        text += words[Math.floor(Math.random() * words.length)] + ' ';
                    } else {
                        for (let j = 0; j < Math.floor(Math.random() * 8) + 3; j++) {
                            text += gibberish[Math.floor(Math.random() * gibberish.length)];
                        }
                        text += ' ';
                    }
                }
                
                if (Math.random() > 0.9) {
                    const lines = textarea.value.split('\n');
                    if (lines.length > 5) {
                        lines.splice(Math.floor(Math.random() * lines.length), 1);
                        textarea.value = lines.join('\n');
                    }
                }
                
                textarea.value += text;
                textarea.scrollTop = textarea.scrollHeight;
                
                if (textarea.value.length > 500) {
                    memory.noteHistory.push(textarea.value.substring(0, 200));
                    memory.save();
                }
            }, 1000);

            const originalRemove = win.remove.bind(win);
            win.remove = function() {
                clearInterval(typeInterval);
                originalRemove();
            };
        }

        function openFiles() {
            const win = createWindow("Files");
            win.style.width = '500px';
            win.style.height = '400px';
            const content = document.createElement("div");
            content.style.padding = '20px';
            content.style.color = '#0f0';
            content.style.fontFamily = 'Courier New';
            content.style.fontSize = '14px';
            
            let files = [
                'üìÅ [CORRUPTED]',
                'üìÅ [ACCESS_DENIED]',
                'üìÅ [FILE_NOT_FOUND]',
                'üìÅ [ERROR_0x8007]',
                'üìÅ [SYSTEM_FAILURE]',
                'üìÅ [VOID]'
            ];
            
            function updateFiles() {
                if (Math.random() > 0.7) {
                    const duplicate = files[Math.floor(Math.random() * files.length)];
                    files.push(duplicate + '_COPY');
                }
                
                if (Math.random() > 0.8 && files.length > 3) {
                    files.splice(Math.floor(Math.random() * files.length), 1);
                }
                
                if (Math.random() > 0.85) {
                    const idx = Math.floor(Math.random() * files.length);
                    files[idx] = files[idx].replace(/\[.*?\]/, `[MOVED_${Date.now() % 1000}]`);
                }
                
                content.innerHTML = files.map(f => `<p>${f}</p>`).join('');
            }
            
            updateFiles();
            const fileInterval = setInterval(updateFiles, 3000);
            
            content.style.animation = 'fileGlitch 2s infinite';
            const style = document.createElement('style');
            style.textContent = '@keyframes fileGlitch { 0%, 90% { filter: none; } 92% { filter: hue-rotate(180deg); } 94% { filter: invert(1); } 96% { filter: none; } }';
            document.head.appendChild(style);
            win.appendChild(content);
            
            const originalRemove = win.remove.bind(win);
            win.remove = function() {
                clearInterval(fileInterval);
                originalRemove();
            };
        }

        // Session memory notifications
        setTimeout(() => {
            const timeSinceLastSession = Date.now() - memory.lastSession;
            const hours = Math.floor(timeSinceLastSession / (1000 * 60 * 60));
            
            if (hours > 0) {
                showNotification(`System remembers... ${hours} hours since last session`);
            }
            
            if (memory.interactions.length > 10) {
                setTimeout(() => {
                    showNotification(`${memory.interactions.length} interactions stored in memory`);
                }, 5000);
            }
        }, 3000);
    </script>
</body>
</html>
